{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://zebric.dev/schemas/blueprint.json",
  "title": "Zebric Blueprint Schema",
  "description": "Schema for validating Zebric Blueprint configurations in both JSON and TOML formats",
  "$ref": "#/definitions/Blueprint",
  "definitions": {
    "Blueprint": {
      "type": "object",
      "properties": {
        "version": {
          "type": "string"
        },
        "hash": {
          "type": "string"
        },
        "project": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "version": {
              "type": "string"
            },
            "description": {
              "type": "string"
            },
            "runtime": {
              "type": "object",
              "properties": {
                "min_version": {
                  "type": "string"
                }
              },
              "required": [
                "min_version"
              ],
              "additionalProperties": false
            }
          },
          "required": [
            "name",
            "version",
            "runtime"
          ],
          "additionalProperties": false
        },
        "entities": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "fields": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "type": {
                      "type": "string",
                      "enum": [
                        "ULID",
                        "UUID",
                        "Text",
                        "LongText",
                        "Email",
                        "Integer",
                        "Float",
                        "Boolean",
                        "DateTime",
                        "Date",
                        "JSON",
                        "Enum",
                        "Ref"
                      ]
                    },
                    "primary_key": {
                      "type": "boolean"
                    },
                    "unique": {
                      "type": "boolean"
                    },
                    "index": {
                      "type": "boolean"
                    },
                    "required": {
                      "type": "boolean"
                    },
                    "nullable": {
                      "type": "boolean"
                    },
                    "default": {},
                    "values": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "ref": {
                      "type": "string"
                    },
                    "access": {
                      "type": "object",
                      "properties": {
                        "read": {
                          "anyOf": [
                            {
                              "type": "boolean"
                            },
                            {
                              "type": "object",
                              "additionalProperties": {}
                            },
                            {
                              "type": "object",
                              "properties": {
                                "or": {
                                  "type": "array",
                                  "items": {}
                                }
                              },
                              "required": [
                                "or"
                              ],
                              "additionalProperties": false
                            },
                            {
                              "type": "object",
                              "properties": {
                                "and": {
                                  "type": "array",
                                  "items": {}
                                }
                              },
                              "required": [
                                "and"
                              ],
                              "additionalProperties": false
                            }
                          ]
                        },
                        "write": {
                          "anyOf": [
                            {
                              "type": "boolean"
                            },
                            {
                              "type": "object",
                              "additionalProperties": {}
                            },
                            {
                              "type": "object",
                              "properties": {
                                "or": {
                                  "type": "array",
                                  "items": {}
                                }
                              },
                              "required": [
                                "or"
                              ],
                              "additionalProperties": false
                            },
                            {
                              "type": "object",
                              "properties": {
                                "and": {
                                  "type": "array",
                                  "items": {}
                                }
                              },
                              "required": [
                                "and"
                              ],
                              "additionalProperties": false
                            }
                          ]
                        }
                      },
                      "additionalProperties": false
                    }
                  },
                  "required": [
                    "name",
                    "type"
                  ],
                  "additionalProperties": false
                }
              },
              "relations": {
                "type": "object",
                "additionalProperties": {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": [
                        "hasMany",
                        "hasOne",
                        "belongsTo",
                        "manyToMany"
                      ]
                    },
                    "entity": {
                      "type": "string"
                    },
                    "foreign_key": {
                      "type": "string"
                    },
                    "through": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "type",
                    "entity"
                  ],
                  "additionalProperties": false
                }
              },
              "access": {
                "type": "object",
                "properties": {
                  "read": {
                    "anyOf": [
                      {
                        "type": "boolean"
                      },
                      {
                        "type": "object",
                        "additionalProperties": {}
                      },
                      {
                        "type": "object",
                        "properties": {
                          "or": {
                            "type": "array",
                            "items": {}
                          }
                        },
                        "required": [
                          "or"
                        ],
                        "additionalProperties": false
                      },
                      {
                        "type": "object",
                        "properties": {
                          "and": {
                            "type": "array",
                            "items": {}
                          }
                        },
                        "required": [
                          "and"
                        ],
                        "additionalProperties": false
                      }
                    ]
                  },
                  "create": {
                    "anyOf": [
                      {
                        "type": "boolean"
                      },
                      {
                        "type": "object",
                        "additionalProperties": {}
                      },
                      {
                        "type": "object",
                        "properties": {
                          "or": {
                            "type": "array",
                            "items": {}
                          }
                        },
                        "required": [
                          "or"
                        ],
                        "additionalProperties": false
                      },
                      {
                        "type": "object",
                        "properties": {
                          "and": {
                            "type": "array",
                            "items": {}
                          }
                        },
                        "required": [
                          "and"
                        ],
                        "additionalProperties": false
                      }
                    ]
                  },
                  "update": {
                    "anyOf": [
                      {
                        "type": "boolean"
                      },
                      {
                        "type": "object",
                        "additionalProperties": {}
                      },
                      {
                        "type": "object",
                        "properties": {
                          "or": {
                            "type": "array",
                            "items": {}
                          }
                        },
                        "required": [
                          "or"
                        ],
                        "additionalProperties": false
                      },
                      {
                        "type": "object",
                        "properties": {
                          "and": {
                            "type": "array",
                            "items": {}
                          }
                        },
                        "required": [
                          "and"
                        ],
                        "additionalProperties": false
                      }
                    ]
                  },
                  "delete": {
                    "anyOf": [
                      {
                        "type": "boolean"
                      },
                      {
                        "type": "object",
                        "additionalProperties": {}
                      },
                      {
                        "type": "object",
                        "properties": {
                          "or": {
                            "type": "array",
                            "items": {}
                          }
                        },
                        "required": [
                          "or"
                        ],
                        "additionalProperties": false
                      },
                      {
                        "type": "object",
                        "properties": {
                          "and": {
                            "type": "array",
                            "items": {}
                          }
                        },
                        "required": [
                          "and"
                        ],
                        "additionalProperties": false
                      }
                    ]
                  }
                },
                "additionalProperties": false
              },
              "indexes": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "fields": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "unique": {
                      "type": "boolean"
                    },
                    "name": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "fields"
                  ],
                  "additionalProperties": false
                }
              }
            },
            "required": [
              "name",
              "fields"
            ],
            "additionalProperties": false
          }
        },
        "pages": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "path": {
                "type": "string"
              },
              "title": {
                "type": "string"
              },
              "auth": {
                "type": "string",
                "enum": [
                  "required",
                  "optional",
                  "none"
                ]
              },
              "layout": {
                "type": "string"
              },
              "queries": {
                "type": "object",
                "additionalProperties": {
                  "type": "object",
                  "properties": {
                    "entity": {
                      "type": "string"
                    },
                    "where": {
                      "type": "object",
                      "additionalProperties": {}
                    },
                    "orderBy": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "string",
                        "enum": [
                          "asc",
                          "desc"
                        ]
                      }
                    },
                    "limit": {
                      "type": "number"
                    },
                    "offset": {
                      "type": "number"
                    },
                    "include": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  },
                  "required": [
                    "entity"
                  ],
                  "additionalProperties": false
                }
              },
              "form": {
                "type": "object",
                "properties": {
                  "entity": {
                    "type": "string"
                  },
                  "method": {
                    "type": "string",
                    "enum": [
                      "create",
                      "update",
                      "delete"
                    ]
                  },
                  "fields": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "type": {
                          "type": "string",
                          "enum": [
                            "text",
                            "textarea",
                            "email",
                            "password",
                            "number",
                            "select",
                            "checkbox",
                            "radio",
                            "file",
                            "date",
                            "datetime"
                          ]
                        },
                        "label": {
                          "type": "string"
                        },
                        "placeholder": {
                          "type": "string"
                        },
                        "required": {
                          "type": "boolean"
                        },
                        "default": {},
                        "options": {
                          "type": "array"
                        },
                        "rows": {
                          "type": "number"
                        },
                        "accept": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "pattern": {
                          "type": "string"
                        },
                        "min": {
                          "type": "number"
                        },
                        "max": {
                          "type": "number"
                        },
                        "error_message": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "name",
                        "type"
                      ],
                      "additionalProperties": false
                    }
                  },
                  "onSuccess": {
                    "type": "object",
                    "properties": {
                      "redirect": {
                        "type": "string"
                      },
                      "message": {
                        "type": "string"
                      }
                    },
                    "additionalProperties": false
                  },
                  "onError": {
                    "type": "object",
                    "properties": {
                      "message": {
                        "type": "string"
                      }
                    },
                    "additionalProperties": false
                  }
                },
                "required": [
                  "entity",
                  "method",
                  "fields"
                ],
                "additionalProperties": false
              },
              "meta": {
                "type": "object",
                "properties": {
                  "description": {
                    "type": "string"
                  },
                  "keywords": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "og_image": {
                    "type": "string"
                  }
                },
                "additionalProperties": false
              },
              "behavior": {
                "type": "object",
                "properties": {
                  "intent": {
                    "type": "string"
                  },
                  "render": {
                    "type": "string"
                  }
                },
                "additionalProperties": true
              }
            },
            "required": [
              "path",
              "title",
              "layout"
            ],
            "additionalProperties": false
          }
        },
        "workflows": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "trigger": {
                "type": "object",
                "properties": {
                  "entity": {
                    "type": "string"
                  },
                  "event": {
                    "type": "string",
                    "enum": [
                      "create",
                      "update",
                      "delete"
                    ]
                  },
                  "condition": {
                    "type": "object",
                    "additionalProperties": {}
                  }
                },
                "required": [
                  "entity",
                  "event"
                ],
                "additionalProperties": false
              },
              "steps": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "type"
                  ],
                  "additionalProperties": true
                }
              }
            },
            "required": [
              "name",
              "trigger",
              "steps"
            ],
            "additionalProperties": false
          }
        },
        "auth": {
          "type": "object",
          "properties": {
            "providers": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "trustedOrigins": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "session": {
              "type": "object",
              "properties": {
                "duration": {
                  "type": "number"
                },
                "idle_timeout": {
                  "type": "number"
                }
              },
              "additionalProperties": false
            },
            "permissions": {
              "type": "object",
              "additionalProperties": {
                "type": "object",
                "properties": {
                  "allow": {
                    "anyOf": [
                      {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "entity": {
                              "type": "string"
                            },
                            "actions": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              }
                            },
                            "condition": {
                              "anyOf": [
                                {
                                  "type": "boolean"
                                },
                                {
                                  "type": "object",
                                  "additionalProperties": {}
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "or": {
                                      "type": "array",
                                      "items": {}
                                    }
                                  },
                                  "required": [
                                    "or"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "and": {
                                      "type": "array",
                                      "items": {}
                                    }
                                  },
                                  "required": [
                                    "and"
                                  ],
                                  "additionalProperties": false
                                }
                              ]
                            }
                          },
                          "required": [
                            "entity",
                            "actions",
                            "condition"
                          ],
                          "additionalProperties": false
                        }
                      }
                    ]
                  },
                  "deny": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "required": [
                  "allow"
                ],
                "additionalProperties": false
              }
            }
          },
          "required": [
            "providers"
          ],
          "additionalProperties": false
        },
        "plugins": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "version": {
                "type": "string"
              },
              "enabled": {
                "type": "boolean"
              },
              "trust_level": {
                "type": "string",
                "enum": [
                  "limited",
                  "full"
                ]
              },
              "capabilities": {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": [
                    "database",
                    "network",
                    "storage",
                    "filesystem"
                  ]
                }
              },
              "config": {
                "type": "object",
                "additionalProperties": {}
              }
            },
            "required": [
              "name",
              "enabled"
            ],
            "additionalProperties": false
          }
        },
        "ui": {
          "type": "object",
          "properties": {
            "render_mode": {
              "type": "string",
              "enum": [
                "server",
                "hybrid",
                "spa"
              ]
            },
            "theme": {
              "type": "string"
            },
            "progressive_enhancement": {
              "type": "string",
              "enum": [
                "none",
                "alpine",
                "htmx"
              ]
            },
            "view_transitions": {
              "type": "boolean"
            },
            "tailwind": {
              "type": "object",
              "properties": {
                "primary_color": {
                  "type": "string"
                },
                "secondary_color": {
                  "type": "string"
                },
                "font_family": {
                  "type": "string"
                }
              },
              "additionalProperties": true
            },
            "css": {
              "type": "object",
              "properties": {
                "file": {
                  "type": "string"
                }
              },
              "additionalProperties": false
            },
            "layouts": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            },
            "components": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            }
          },
          "additionalProperties": false
        }
      },
      "required": [
        "version",
        "project",
        "entities",
        "pages"
      ],
      "additionalProperties": false
    }
  }
}