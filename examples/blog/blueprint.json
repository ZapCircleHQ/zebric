{
  "version": "0.1.0",
  "project": {
    "name": "Blog Example",
    "version": "1.0.0",
    "description": "A simple blog built with Zebric",
    "runtime": {
      "min_version": "0.1.0"
    }
  },
  "entities": [
    {
      "name": "User",
      "fields": [
        {
          "name": "id",
          "type": "ULID",
          "primary_key": true
        },
        {
          "name": "email",
          "type": "Email",
          "unique": true,
          "index": true,
          "required": true
        },
        {
          "name": "name",
          "type": "Text",
          "required": true
        },
        {
          "name": "role",
          "type": "Enum",
          "values": [
            "user",
            "admin"
          ],
          "default": "user"
        },
        {
          "name": "createdAt",
          "type": "DateTime",
          "default": "now"
        },
        {
          "name": "updatedAt",
          "type": "DateTime",
          "default": "now"
        }
      ],
      "relations": {
        "posts": {
          "type": "hasMany",
          "entity": "Post",
          "foreign_key": "authorId"
        }
      }
    },
    {
      "name": "Post",
      "fields": [
        {
          "name": "id",
          "type": "ULID",
          "primary_key": true
        },
        {
          "name": "title",
          "type": "Text",
          "required": true
        },
        {
          "name": "slug",
          "type": "Text",
          "unique": true,
          "index": true,
          "required": true
        },
        {
          "name": "body",
          "type": "LongText",
          "required": true
        },
        {
          "name": "status",
          "type": "Enum",
          "values": [
            "draft",
            "published"
          ],
          "default": "draft"
        },
        {
          "name": "authorId",
          "type": "Ref",
          "ref": "User.id",
          "index": true,
          "required": true
        },
        {
          "name": "createdAt",
          "type": "DateTime",
          "default": "now"
        },
        {
          "name": "updatedAt",
          "type": "DateTime",
          "default": "now"
        }
      ],
      "relations": {
        "author": {
          "type": "belongsTo",
          "entity": "User",
          "foreign_key": "authorId"
        }
      },
      "access": {
        "read": {
          "or": [
            {
              "status": "published"
            },
            {
              "authorId": "$currentUser.id"
            }
          ]
        },
        "create": true,
        "update": {
          "or": [
            {
              "authorId": "$currentUser.id"
            },
            {
              "$currentUser.role": "admin"
            }
          ]
        },
        "delete": {
          "$currentUser.role": "admin"
        }
      }
    }
  ],
  "pages": [
    {
      "path": "/",
      "title": "Home",
      "auth": "none",
      "layout": "list",
      "queries": {
        "posts": {
          "entity": "Post",
          "where": {
            "status": "published"
          },
          "orderBy": {
            "createdAt": "desc"
          },
          "limit": 10,
          "include": [
            "author"
          ]
        }
      }
    },
    {
      "path": "/posts",
      "title": "All Posts",
      "auth": "none",
      "layout": "list",
      "queries": {
        "posts": {
          "entity": "Post",
          "where": {
            "status": "published"
          },
          "orderBy": {
            "createdAt": "desc"
          },
          "limit": 20,
          "include": [
            "author"
          ]
        }
      }
    },
    {
      "path": "/posts/:id",
      "title": "Post Detail",
      "auth": "none",
      "layout": "detail",
      "queries": {
        "post": {
          "entity": "Post",
          "where": {
            "id": "$params.id"
          },
          "include": [
            "author"
          ]
        }
      }
    },
    {
      "path": "/posts/new",
      "title": "New Post",
      "auth": "optional",
      "layout": "form",
      "form": {
        "entity": "Post",
        "method": "create",
        "fields": [
          {
            "name": "title",
            "type": "text",
            "label": "Title",
            "required": true
          },
          {
            "name": "slug",
            "type": "text",
            "label": "URL Slug",
            "required": true,
            "pattern": "^[a-z0-9-]+$",
            "error_message": "Slug must be lowercase letters, numbers, and hyphens only"
          },
          {
            "name": "body",
            "type": "textarea",
            "label": "Content",
            "rows": 20,
            "required": true
          },
          {
            "name": "status",
            "type": "select",
            "label": "Status",
            "options": [
              "draft",
              "published"
            ],
            "default": "draft"
          }
        ],
        "onSuccess": {
          "redirect": "/posts/{id}",
          "message": "Post created successfully!"
        }
      }
    },
    {
      "path": "/posts/:id/edit",
      "title": "Edit Post",
      "auth": "required",
      "layout": "form",
      "queries": {
        "post": {
          "entity": "Post",
          "where": {
            "id": "$params.id"
          }
        }
      },
      "form": {
        "entity": "Post",
        "method": "update",
        "fields": [
          {
            "name": "title",
            "type": "text",
            "label": "Title",
            "required": true
          },
          {
            "name": "slug",
            "type": "text",
            "label": "URL Slug",
            "required": true
          },
          {
            "name": "body",
            "type": "textarea",
            "label": "Content",
            "rows": 20,
            "required": true
          },
          {
            "name": "status",
            "type": "select",
            "label": "Status",
            "options": [
              "draft",
              "published"
            ]
          }
        ],
        "onSuccess": {
          "redirect": "/posts/{id}",
          "message": "Post updated successfully!"
        }
      }
    },
    {
      "path": "/posts/:id/delete",
      "title": "Delete Post",
      "auth": "required",
      "layout": "form",
      "queries": {
        "post": {
          "entity": "Post",
          "where": {
            "id": "$params.id"
          }
        }
      },
      "form": {
        "entity": "Post",
        "method": "delete",
        "fields": [],
        "onSuccess": {
          "redirect": "/posts",
          "message": "Post deleted successfully"
        }
      }
    },
    {
      "path": "/users/:id",
      "title": "User Profile",
      "auth": "none",
      "layout": "detail",
      "queries": {
        "user": {
          "entity": "User",
          "where": {
            "id": "$params.id"
          }
        },
        "posts": {
          "entity": "Post",
          "where": {
            "authorId": "$params.id",
            "status": "published"
          },
          "orderBy": {
            "createdAt": "desc"
          },
          "limit": 10
        }
      }
    },
    {
      "path": "/dashboard",
      "title": "Dashboard",
      "auth": "required",
      "layout": "dashboard",
      "queries": {
        "totalPosts": {
          "entity": "Post",
          "orderBy": {
            "createdAt": "desc"
          },
          "limit": 5
        },
        "draftPosts": {
          "entity": "Post",
          "where": {
            "status": "draft"
          },
          "orderBy": {
            "createdAt": "desc"
          },
          "limit": 5
        },
        "publishedPosts": {
          "entity": "Post",
          "where": {
            "status": "published"
          },
          "orderBy": {
            "createdAt": "desc"
          },
          "limit": 5
        },
        "recentUsers": {
          "entity": "User",
          "orderBy": {
            "createdAt": "desc"
          },
          "limit": 5
        }
      }
    }
  ],
  "auth": {
    "providers": [
      "email"
    ],
    "trustedOrigins": [
      "http://localhost:3000",
      "http://0.0.0.0:3000"
    ]
  },
  "ui": {
    "render_mode": "server",
    "theme": "default",
    "view_transitions": true
  }
}
